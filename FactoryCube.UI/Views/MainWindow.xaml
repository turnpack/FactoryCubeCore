<Window x:Class="FactoryCube.UI.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:FactoryCube.UI.Views"
        xmlns:enums="clr-namespace:FactoryCube.UI.Enums"
        xmlns:h="http://schemas.mvtec.com/halcondotnet"
        Title="FactoryCube" Height="800" Width="1200"
        mc:Ignorable="d"
        KeyDown="Window_KeyDown" KeyUp="Window_KeyUp"
>
    <Window.InputBindings>
        <KeyBinding Key="G" Modifiers="Control" Command="{Binding ToggleGridCommand}" />
        <KeyBinding Key="H" Modifiers="Control" Command="{Binding ToggleCrosshairCommand}" />
    </Window.InputBindings>


    <DockPanel>

        <!-- Menu Bar -->
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="File">
                <MenuItem Header="Exit" Click="Exit_Click"/>
            </MenuItem>
            <MenuItem Header="View">
                <MenuItem Header="Toggle Log Window"/>
            </MenuItem>
        </Menu>

        <!-- Toolbar -->
        <ToolBar DockPanel.Dock="Top">
            <Button Content="Start Preview" Command="{Binding StartPreviewCommand}" />
            <Button Content="Stop Preview" Command="{Binding StopPreviewCommand}" />
            <Button Content="Refresh" Command="{Binding RefreshCamerasCommand}" />
            <ComboBox ItemsSource="{Binding AvailableCameras}"
                      SelectedItem="{Binding SelectedCamera}"
                      DisplayMemberPath="Name"
                      Width="250"/>
            <Button Content="Crosshair" Command="{Binding ToggleCrosshairCommand}" />
            <Button Content="Grid" Command="{Binding ToggleGridCommand}" />
            <Button Content="Reset Zoom" Command="{Binding ResetZoomCommand}" />
            <ComboBox SelectedValue="{Binding CurrentRoiShape}" SelectedValuePath="Tag">
                <ComboBoxItem Content="Rectangle" Tag="{x:Static enums:RoiShape.Rectangle}" />
                <ComboBoxItem Content="Ellipse"   Tag="{x:Static enums:RoiShape.Ellipse}" />
                <ComboBoxItem Content="Polygon"   Tag="{x:Static enums:RoiShape.Polygon}" />
            </ComboBox>
        </ToolBar>
        <Border Padding="8">
            <StackPanel DockPanel.Dock="Left" Width="240" Background="#EEE">
                <TextBlock Text="ROIs" FontWeight="Bold" Margin="0,0,0,8"/>
                <ListBox ItemsSource="{Binding PlacedRois}" SelectedItem="{Binding SelectedRoi}"
                 BorderThickness="0" ScrollViewer.VerticalScrollBarVisibility="Auto">
                    <ListBox.ItemTemplate>
                        <DataTemplate DataType="local:RoiItem">
                            <DockPanel Margin="0,2">
                                <TextBox Text="{Binding Name, Mode=TwoWay}" BorderThickness="0"
                         VerticalAlignment="Center" Width="100"/>
                                <Button Content="?" Command="{Binding DataContext.MoveUpRoiCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                        CommandParameter="{Binding}" Width="24" Margin="4,0"/>
                                <Button Content="?" Command="{Binding DataContext.MoveDownRoiCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                        CommandParameter="{Binding}" Width="24"/>
                                <Button Content="?" Command="{Binding DataContext.DeleteRoiCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                        CommandParameter="{Binding}" Width="24" Foreground="Red"/>
                            </DockPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </StackPanel>
        </Border>

        <!-- Status Bar -->
        <StatusBar DockPanel.Dock="Bottom">
            <TextBlock Text="{Binding StatusMessage}" />
        </StatusBar>

        <!-- Main Workspace -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3*"/>
                <ColumnDefinition Width="2*"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="200"/>
            </Grid.RowDefinitions>

            <!-- Live Image View -->
            <Border Grid.Column="0" Grid.Row="0" Margin="10" BorderBrush="Gray" BorderThickness="1">
                <h:HSmartWindowControlWPF x:Name="HalconView"
                                            Loaded="HalconView_Loaded"
                                            Grid.Row="0"
                                            Grid.Column="1"
                                            Margin="10"
                                            HorizontalAlignment="Stretch"
                                            VerticalAlignment="Stretch"
                                            PreviewMouseLeftButtonDown="HalconView_MouseLeftButtonDown"
                                            PreviewMouseMove="HalconView_MouseMove"
                                            MouseLeftButtonDown="HalconView_MouseLeftButtonDown"
                                            MouseWheel="HalconView_MouseWheel"
                                            MouseRightButtonDown="HalconView_MouseRightButtonDown"
                                            MouseRightButtonUp="HalconView_MouseRightButtonUp"
                                            MouseMove="HalconView_MouseMove"/>                                            
            </Border>
            

            <!-- Camera Settings Panel -->
            <StackPanel Grid.Column="1" Grid.Row="0" Margin="10" Orientation="Vertical">
                <TextBlock Text="Exposure Time (us)" Width="120"/>
                <Slider Minimum="100" Maximum="50000" TickFrequency="1000"
                        Value="{Binding SelectedCamera.ExposureTime, Mode=TwoWay}" Width="200"/>
                <TextBlock Text="{Binding SelectedCamera.ExposureTime, StringFormat={}{0:N0} us}" Width="80" Margin="10,0,0,0"/>

                <TextBlock Text="Frame Rate (fps)" Width="120"/>
                <Slider Minimum="1" Maximum="60" TickFrequency="1"
                        Value="{Binding SelectedCamera.FrameRate, Mode=TwoWay}" Width="200"/>
                <TextBlock Text="{Binding SelectedCamera.FrameRate, StringFormat={}{0:N1} fps}" Width="80" Margin="10,0,0,0"/>

                <TextBlock Text="Gain (dB)" Width="120"/>
                <Slider Minimum="0" Maximum="24" TickFrequency="1"
                        Value="{Binding SelectedCamera.Gain, Mode=TwoWay}" Width="200"/>
                <TextBlock Text="{Binding SelectedCamera.Gain, StringFormat={}{0:N1} dB}" Width="80" Margin="10,0,0,0"/>

                <TextBlock Text="Trigger Mode" Margin="0,10,0,2"/>
                <ComboBox SelectedItem="{Binding SelectedCamera.TriggerMode, Mode=TwoWay}">
                    <ComboBoxItem Content="On" />
                    <ComboBoxItem Content="Off" />
                    <ComboBoxItem Content="Software" />
                </ComboBox>

                <Button Content="Apply Settings"
                        Command="{Binding ApplyCameraSettingsCommand}"
                        Margin="0,20,0,0"
                        HorizontalAlignment="Left"/>
            </StackPanel>

            <!-- Log Output -->
            <TextBox Grid.Column="0" Grid.ColumnSpan="2" Grid.Row="1"
                     Margin="5"
                     FontFamily="Consolas"
                     FontSize="12"
                     Text="{Binding LogOutput}"
                     IsReadOnly="True"
                     TextWrapping="Wrap"
                     VerticalScrollBarVisibility="Auto"/>
        </Grid>
    </DockPanel>
</Window>
